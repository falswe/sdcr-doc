<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Coppelia Components: MTC package</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Coppelia Components
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">MTC package </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>This package is contains the necessary logic to command and control the robot at high level to interact with the human. The package is designed as a client-server architecture where the client control the enviroment and sends requests accordingly while the server receives the requests and operates the robot at high level via the MoveIt task constructor. Here is a diagram to better explain the architecutre of the system:</p>
<div class="image">
<img src="Pkg_diagram.jpg" alt=""/>
</div>
<h1><a class="anchor" id="client_sec"></a>
MTC Client</h1>
<p>The mtc client uses the behaviour tree library with the ros2 wrapper to control the behaviour of the robot at runtime based on the available data and the current state of the enviroment. The tree can be seen as a state machine and easily explained with a diagram:</p>
<div class="image">
<img src="d1.jpg" alt=""/>
</div>
<p>The necessary data from the enviroment is read by the client using topics in CoppeliaSim which publish the position of the target object and of the target human in real time. These topics utilize custom msgs that have been included in Coppelia's ros2 interface:</p><ul>
<li><b>human_msgs/msg/HumanMsg</b>: this msg contains the center of the human (collision approximated to a box) and the taget position of the object for the handover. This position is at the tip of the right hand of the human.</li>
<li><b>cylinder_msgs/msg/CylinderMsg</b>: publishes the information of the target object (a cylinder) offering the same data that <b>shape_msgs/msg/SolidPrimitive</b> would offer but in a more compact way (SolidPrimitive was not used due to a bug with the Coppelia interface).</li>
</ul>
<p>The client also implements an emergency stop in caso of sudden movement of the human during the execution of the calculated handover to avoid unpredictable collisions halting the robot instantly.</p>
<h1><a class="anchor" id="server_sec"></a>
MTC Server</h1>
<p>The mtc server handles the requests and operates the robot via the MoveIt task constructor and, at low level, via hw interface and controllers from ros2 control. Upon the arrival of a request the server receives the object postion, the goal position and the human position; this data is used to calculate a chain of simple tasks to execute the handover. The simple tasks are:</p><ul>
<li>open hand</li>
<li>move to pick the object</li>
<li>pick the object (close hand)</li>
<li>lift it from the table</li>
<li>move to goal position</li>
<li>open hand (handover)</li>
<li>retreat</li>
<li>return home (starting position)</li>
</ul>
<p>These steps are planned using MoveIt, as a solver BiRTT is used as it proved to be the fastest option after comparisons with the other available options. After an high level solution is found the robot is moved at low level using the configured controllers while the server deals for possible halt requests in case of emergency.</p>
<p>Note: Due to the random nature of BiRTT the server might fail multiple times to find a fasible plan before finding a solution. In theory we could go on forever until a soluton is found. For convenience however the server stops after 5 consecutive fails and returns an error code </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
